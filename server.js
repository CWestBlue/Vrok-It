var express = require('express');
//var multer = require('multer');
var morgan = require('morgan');
var api = require('./api');

var app = express();

var done = false;

app.use(morgan({ format: 'dev', immediate: true }));     

/////////////////////////////////////////////////////////////////////////////////
//  Webpages server
//
/////////////////////////////////////////////////////////////////////////////////
app.use(function (req, res, next) {
  res.header("Access-Control-Allow-Origin", "*");
  res.header("Access-Control-Allow-Headers", "X-Requested-With");
  next();
});

app.use('/', express.static(__dirname + '/html'));

/////////////////////////////////////////////////////////////////////////////////
//  Rest API
//
/////////////////////////////////////////////////////////////////////////////////
app.get('/api/token', api.getToken);

/////////////////////////////////////////////////////////////////////////////////
//  
//
/////////////////////////////////////////////////////////////////////////////////
app.listen(process.env.PORT || 5000);

console.log('Listening on port 5000...');
